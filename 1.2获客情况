####创建临时表####
CREATE TABLE temp_behavior LIKE userbehavior;

###截取10w条数据作为临时表的数据####
INSERT INTO temp_behavior
SELECT * FROM userbehavior LIMIT 100000;
#查看临时表的导入情况
SELECT * FROM temp_behavior;


###计算页面浏览量 page view###
###需求理解：点击即算浏览量
SELECT dates, count(*) as 'pv'
FROM temp_behavior
WHERE behavior_type='pv'
GROUP BY dates;

###独立访客数量 unique visitor###
###需求理解：对用户数量去重，得到独立的访客数量
SELECT dates, count(DISTINCT(user_id)) as 'pv'
FROM temp_behavior
WHERE behavior_type='pv'
GROUP BY dates;

###浏览深度 pv/uv###
SELECT dates
, count(*) AS 'pv'
, count(DISTINCT user_id) AS 'uv'
,round(count(*)/count(DISTINCT user_id),2) as 'pv/uv'
FROM temp_behavior
WHERE behavior_type='pv'
GROUP BY dates;

####处理真实数据####
###创建新表评估浏览量，访客数量和浏览深度###
create table pv_uv_puv (
dates char(10)
, pv int(9)
, uv int(9)
,puv decimal(10,1)
);

INSERT INTO pv_uv_puv
SELECT dates
,COUNT(*) 'pv'
,COUNT(DISTINCT(user_id)) 'uv'
,ROUND(COUNT(*)/COUNT(DISTINCT(user_id)),2) 'puv'
FROM userbehavior
WHERE behavior_type='pv'
GROUP BY dates;

